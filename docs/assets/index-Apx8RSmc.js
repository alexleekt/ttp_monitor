(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const e of t)if(e.type==="childList")for(const c of e.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function r(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?e.credentials="include":t.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function i(t){if(t.ep)return;t.ep=!0;const e=r(t);fetch(t.href,e)}})();const k="https://ttp.cbp.dhs.gov/schedulerapi/locations/{locationId}/slots?startTimestamp={start}&endTimestamp={end}",N=document.getElementById("location-select"),b=document.getElementById("start-date"),v=document.getElementById("end-date"),x=document.getElementById("min-hour"),P=document.getElementById("max-hour"),U=document.getElementById("weekend-toggle"),f=document.getElementById("refresh-btn");document.getElementById("results-container");const g=document.getElementById("grid-wrapper"),H=document.getElementById("empty-state"),A=document.getElementById("summary-cards"),q=document.getElementById("total-slots"),F=document.getElementById("total-days");let B=!1;function K(){const o=new Date,n=new Date(o);n.setMonth(o.getMonth()+6),b.value=o.toISOString().split("T")[0],v.value=n.toISOString().split("T")[0],f.addEventListener("click",R)}async function R(){if(B)return;const o=N.value,n=`${b.value}T00:00:00`,r=`${v.value}T23:59:59`,i=parseInt(x.value),t=parseInt(P.value),e=U.checked;S(!0);try{const c=await W(o,n,r);Z(c,i,t,e)}catch(c){console.error(c),alert("Failed to fetch appointments. Please try again later.")}finally{S(!1)}}async function W(o,n,r){const i=k.replace("{locationId}",o).replace("{start}",n).replace("{end}",r),t=await fetch(i);if(!t.ok)throw new Error("API request failed");return(await t.json()).filter(c=>c.active>0)}function S(o){B=o;const n=f.querySelector(".btn-text"),r=f.querySelector(".loader");o?(n.classList.add("hidden"),r.classList.remove("hidden"),f.disabled=!0):(n.classList.remove("hidden"),r.classList.add("hidden"),f.disabled=!1)}function Z(o,n,r,i){H.classList.add("hidden"),g.classList.remove("hidden"),A.classList.remove("hidden"),g.innerHTML="";let t=o;if(i){const s=new Date;s.setDate(s.getDate()+30),t=o.filter(l=>{const a=new Date(l.timestamp),d=a.getUTCDay();return(d===0||d===6)&&a<=s})}const e={};t.forEach(s=>{const a=new Date(s.timestamp).toLocaleDateString("en-US",{month:"long",year:"numeric",timeZone:"UTC"}),d=s.timestamp.split("T")[0];e[a]||(e[a]={}),e[a][d]||(e[a][d]=[]),e[a][d].push(s)});const c=Object.keys(e).sort((s,l)=>new Date(s)-new Date(l));let w=0;c.forEach(s=>{const l=document.createElement("div");l.className="month-block",l.innerHTML=`<h2>${s}</h2>`;const a=document.createElement("table");a.className="grid-table";const d=Array.from({length:r-n+1},(m,u)=>u+n),$=`
            <tr>
                <th class="date-cell">Date</th>
                ${d.map(m=>`<th>${m.toString().padStart(2,"0")}</th>`).join("")}
                <th>Total</th>
            </tr>
        `;let E="";const I=Object.keys(e[s]).sort();w+=I.length,I.forEach(m=>{const u=new Date(m),O=u.toLocaleDateString("en-US",{weekday:"short",timeZone:"UTC"}),C=u.getUTCDate().toString().padStart(2,"0"),M=new Date,j=u.getTime()-M.getTime(),T=Math.ceil(j/(1e3*60*60*24));let p="red";T<28?p="green":T<=56&&(p="yellow");const D=e[s][m],L=new Array(d.length).fill(0);D.forEach(h=>{const y=new Date(h.timestamp).getHours();y>=n&&y<=r&&L[y-n]++}),E+=`
                <tr>
                    <td class="date-cell ${p}">${C} (${O})</td>
                    ${L.map(h=>`
                        <td>
                            <span class="slot-dot ${h>0?"available "+p:"empty"}">
                                ${h>0?h:"."}
                            </span>
                        </td>
                    `).join("")}
                    <td><strong>${D.length}</strong></td>
                </tr>
            `}),a.innerHTML=`<thead>${$}</thead><tbody>${E}</tbody>`,l.appendChild(a),g.appendChild(l)}),q.textContent=t.length,F.textContent=w}K();
