(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const e of t)if(e.type==="childList")for(const c of e.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function r(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?e.credentials="include":t.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function i(t){if(t.ep)return;t.ep=!0;const e=r(t);fetch(t.href,e)}})();const $="https://ttp.cbp.dhs.gov/schedulerapi/locations/{locationId}/slots?startTimestamp={start}&endTimestamp={end}",C=document.getElementById("location-select"),b=document.getElementById("start-date"),D=document.getElementById("end-date"),j=document.getElementById("min-hour"),k=document.getElementById("max-hour"),M=document.getElementById("weekend-toggle"),h=document.getElementById("refresh-btn");document.getElementById("results-container");const y=document.getElementById("grid-wrapper"),N=document.getElementById("empty-state"),x=document.getElementById("summary-cards"),P=document.getElementById("total-slots"),U=document.getElementById("total-days");let T=!1;function H(){const o=new Date,n=new Date(o);n.setMonth(o.getMonth()+6),b.value=o.toISOString().split("T")[0],D.value=n.toISOString().split("T")[0],h.addEventListener("click",A)}async function A(){if(T)return;const o=C.value,n=`${b.value}T00:00:00`,r=`${D.value}T23:59:59`,i=parseInt(j.value),t=parseInt(k.value),e=M.checked;S(!0);try{const c=await q(o,n,r);F(c,i,t,e)}catch(c){console.error(c),alert("Failed to fetch appointments. Please try again later.")}finally{S(!1)}}async function q(o,n,r){const i=$.replace("{locationId}",o).replace("{start}",n).replace("{end}",r),t=await fetch(i);if(!t.ok)throw new Error("API request failed");return(await t.json()).filter(c=>c.active>0)}function S(o){T=o;const n=h.querySelector(".btn-text"),r=h.querySelector(".loader");o?(n.classList.add("hidden"),r.classList.remove("hidden"),h.disabled=!0):(n.classList.remove("hidden"),r.classList.add("hidden"),h.disabled=!1)}function F(o,n,r,i){N.classList.add("hidden"),y.classList.remove("hidden"),x.classList.remove("hidden"),y.innerHTML="";let t=o;if(i){const s=new Date;s.setDate(s.getDate()+30),t=o.filter(l=>{const a=new Date(l.timestamp),d=a.getUTCDay();return(d===0||d===6)&&a<=s})}const e={};t.forEach(s=>{const a=new Date(s.timestamp).toLocaleDateString("en-US",{month:"long",year:"numeric",timeZone:"UTC"}),d=s.timestamp.split("T")[0];e[a]||(e[a]={}),e[a][d]||(e[a][d]=[]),e[a][d].push(s)});const c=Object.keys(e).sort((s,l)=>new Date(s)-new Date(l));let g=0;c.forEach(s=>{const l=document.createElement("div");l.className="month-block",l.innerHTML=`<h2>${s}</h2>`;const a=document.createElement("table");a.className="grid-table";const d=Array.from({length:r-n+1},(m,p)=>p+n),v=`
            <tr>
                <th class="date-cell">Date</th>
                ${d.map(m=>`<th>${m.toString().padStart(2,"0")}</th>`).join("")}
                <th>Total</th>
            </tr>
        `;let E="";const I=Object.keys(e[s]).sort();g+=I.length,I.forEach(m=>{const p=new Date(m),B=p.toLocaleDateString("en-US",{weekday:"short",timeZone:"UTC"}),O=p.getUTCDate().toString().padStart(2,"0"),w=e[s][m],L=new Array(d.length).fill(0);w.forEach(u=>{const f=new Date(u.timestamp).getHours();f>=n&&f<=r&&L[f-n]++}),E+=`
                <tr>
                    <td class="date-cell">${O} (${B})</td>
                    ${L.map(u=>`
                        <td>
                            <span class="slot-dot ${u>0?"available":"empty"}">
                                ${u>0?u:"."}
                            </span>
                        </td>
                    `).join("")}
                    <td><strong>${w.length}</strong></td>
                </tr>
            `}),a.innerHTML=`<thead>${v}</thead><tbody>${E}</tbody>`,l.appendChild(a),y.appendChild(l)}),P.textContent=t.length,U.textContent=g}H();
